<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

</head>

<body>
    <!-- 1. click 觸發 ajax 從後端調用 json 來渲染  -->
    <h2> 1. click 觸發 ajax 從後端調用 json 來渲染</h2>
    <div id="myDiv">
        <h2>878878889996546</h2>
    </div>
    <button id="b01" type="button">click 觸發 ajax</button>
    <!--  1.click 觸發 ajax 從後端調用 json 來渲染 -->

    <hr>

    <!-- 2. document ready 觸發 local . json -->
    <h2> 2. document ready 觸發 local . json</h2>
    <div id="youDiv">
        <h2> document ready 觸發 local . json</h2>
    </div>
    <!-- 2. document ready 觸發 local . json  -->

    <hr>

    <!-- 3. 利用 select value 值 調用 jq ajax post 對後端 get 查詢接口  做特定資料調用 e.g. 只要 shopcar 資料 -->
    <h2> 3. 利用 select value 值 調用 jq ajax post 對後端 get 查詢接口 做特定資料調用 e.g. 只要 shopcar 資料</h2>
    <h2> 3.1 利用 local.all.json 資料 渲染 select 打造動態的 select</h2>
    <!-- 3.1 利用 local.all.json 資料 渲染 select 打造動態的 select -->
    <div id="heDiv"></div>
    <!-- 3.1 利用 local.all.json 資料 渲染 select 打造動態的 select -->
    <div id="herDiv"></div>
    <!-- 3. 利用 select value 值 調用 jq ajax post 對後端 get 查詢接口  做特定資料調用 e.g. 只要 shopcar 資料 -->

    <hr>

    <!-- 4. 利用 form 調用 post 不使用 jq ajax 直接 request 後端坐驗證查詢 -->
    <h2> 4. 利用 form 調用 post 不使用 jq ajax 直接 request 後端坐驗證查詢</h2>
    <form id="myform" action="https://localhost:44317/api/Default" method="post" enctype="application/json" accept="text/plain">
        <label for="Email">Email : </label>
        <input name="email" id="Email" value="Carl@gmail.com"><br>
        <label for="Password">Password : </label>
        <input name="password" id="Password" placeholder='1234'><br>
        <button id="myformbutton" type='submit'>驗證</button>
        <input name="Authentication" id="Authentication" readonly placeholder="name=Authentication">
        <p>
            一般會用 display:none; 來藏這種必須要傳到後端，但又不給輸入的欄位
        </p>
        <p>
            這裡的狀況：主要不是前端問題，而是涉及到後端取封包的邏輯，每個框架不太一樣需要依據接口格式，所以 form 就必須符合格式，否則根本找不到相對應的接口。你後端要求 {"email":"abcx","password":"qweqwe"} 那就應該組成這樣一包 json，form 不會自動幫你組。 除非接口寫成 methon ( string email, string password )
        </p>
        <p>
            https://stackoverflow.com/questions/19446544/post-request-to-include-content-type-and-json
        </p>
        <p>
            變成必須用非正規方式把資料組成 JSON 格式傳入。 // 此處較不像一般的方式，通常在 form 傳出前攔截是為了前端驗證資料格式 e.g. email / length / 非法字元 ...，而不是轉 JSON 格式
        </p>
    </form>
    <!-- https://stackoverflow.com/questions/19446544/post-request-to-include-content-type-and-json -->
    <!-- 4. 利用 form 調用 post 不使用 jq ajax 直接 request 後端坐驗證查詢 -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.js"></script>
    <script>
        $(document).ready(function() {

            // 1. click 觸發 ajax 從後端調用 json 來渲染
            $("#b01").click(function() {
                htmlobj = $.ajax({
                    url: "https://localhost:44317/api/Default/1",
                    async: false
                });

                // htmlobj 為 jq AJAX 方法所回傳的物件，裡面包含許多內容
                console.log("htmlobj", htmlobj);
                if (htmlobj != undefined) {
                    // 例如 responseJSON 這包就是直接可以調用的 JSON Obj
                    console.log("parseobj", htmlobj.responseJSON);
                    if (htmlobj.responseJSON != undefined) {
                        var jsonobj = htmlobj.responseJSON;

                        // 調用方法如下:
                        // 因為沒有像後端或是 TypeScript 的強型別所以雖然能用 . . 來取用物件與陣列與筆數，
                        // 但並不會自動提示，容易出錯 ( 最好先定義接口類別，例如用物件需告完後塞入值 )
                        console.log("jsonobj.layout", jsonobj.layout)
                        console.log("jsonobj.layout.header", jsonobj.layout.header)
                        console.log("jsonobj.layout.header.title", jsonobj.layout.header.title)
                        console.log("jsonobj.layout.header.navbar.navNames.length", jsonobj.layout.header.navbar.navNames.length)
                        var length = jsonobj.layout.header.navbar.navNames.length;
                        console.log("jsonobj.layout.header.navbar.navNames[0]", jsonobj.layout.header.navbar.navNames[0])

                        // 如何利用控制流程渲染畫面
                        var TestText = "";
                        for (var i = 0; i < length; i++) {
                            TestText += "<p style='color:red'>" + jsonobj.layout.header.navbar.navNames[i] + "</p>"
                            if (jsonobj.layout.header.navbar.navNames[i] == "Wishlist") {
                                TestText += "<------這是車子"
                            }
                        }
                        $("#myDiv").html(TestText);
                    } else {
                        alert('請確定調用的伺服器有正確開啟，或確認當下網路狀況。')
                    }
                }
            });
            // 1. click 觸發 ajax 從後端調用 json 來渲染

            // 2. document ready 觸發 local . json
            localobj = $.ajax({
                url: "All.json",
                async: false
            });
            console.log("localobj", localobj.responseJSON)
            var JSONstringify = JSON.stringify(localobj.responseJSON.banner);
            $("#youDiv").html(JSONstringify);
            // 2. document ready 觸發 local . json

            // 3. 利用 select value 值 調用 jq ajax post 對後端 get 查詢接口  做特定資料調用 e.g. 只要 shopcar 資料
            // 3.1 利用 local.all.json 資料 渲染 select 打造動態的 select
            var selectTag = "";
            // https://www.w3schools.com/tags/tag_select.asp
            var PageName = "頁面: <select name='PageName' id='PageName'><option value='homePage'>homePage</option></select>。"; // 頁面選單
            var PartName = "元件: <select name='PartName' id='PartName'>"; // 元件名稱
            // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries
            for (const [key, value] of Object.entries(localobj.responseJSON)) {
                console.log(`${key}: ${value}`);
                PartName += "<option value='" + key + "'>" + key + "</option>";
            }
            PartName += "<option value='shopBag'>shopBag</option></select>。";
            var id = "筆數: <input name='id'placeholder='id' id='id' value='Carl@gmail.com'/>。"; // id 識別值

            selectTag = PageName + PartName + id + "<button type='button' onclick='ajaxdemo()'>查詢</button>";
            $("#heDiv").html(selectTag);
            // 3.1 利用 local.all.json 資料 渲染 select 打造動態的 select
            // 3. 利用 select value 值 調用 jq ajax post 對後端 get 查詢接口  做特定資料調用 e.g. 只要 shopcar 資料


        });

        // 4. 利用 form 調用 post 不使用 jq ajax 直接 request 後端坐驗證查詢

        // 這裡的狀況：主要不是前端問題，而是涉及到後端取封包的邏輯，每個框架不太一樣需要依據接口格式，所以 form 就必須符合格式，否則根本找不到相對應的接口。
        // https://stackoverflow.com/questions/19446544/post-request-to-include-content-type-and-json
        // 變成必須用非正規方式把資料組成 JSON 格式傳入。
        // 此處較不像一般的方式，通常在 form 傳出前攔截是為了前端驗證資料格式 e.g. email / length / 非法字元 ...，而不是轉 JSON 格式
        // https://www.w3school.com.cn/jquery/event_submit.asp

        // $('#myform').submit() // 等於直述句會直接觸法此 form submit

        $('#myform').submit(function(e) {
            var result = mixform();
            return result;
        });

        function mixform() {
            return confirm('確定要進行後端驗證?');
        }

        // 4. 利用 form 調用 post 不使用 jq ajax 直接 request 後端坐驗證查詢

        // 把以上方法寫成 method 或 function 即可共用，類似抽出來不用寫重複的方法

        function ajaxdemo() {

            var PageName = "PageName=" + $("#PageName").val() + "&";
            var PartName = "PartName=" + $("#PartName").val() + "&";
            var id = "id=" + $("#id").val();

            alert("PageName: " + PageName + "\nPartName: " + PartName + "\nid: " + id);

            var Select = PageName + PartName + id;

            localobj = $.ajax({
                url: "https://localhost:44317/api/Default?" + Select,
                async: false
            });
            var localobj = JSON.stringify(localobj);
            $("#herDiv").html(localobj);
        }
    </script>
</body>

</html>